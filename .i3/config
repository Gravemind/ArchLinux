# i3 config file (v4)
#
# Please see http://i3wm.org/docs/userguide.html for a complete reference!
#

# Variables
set $ModK           Mod4
set $resize_step    100
set $screenL        DP-4
set $screenR        DP-2

set $keyLeft        j
set $keyRight       l
set $keyUp          i
set $keyDown        k

set $layouts        ~/.i3/layouts

ipc-socket ~/.i3/ipc.sock

#
# Style and behaviors
#

# Font for window titles
font xft:Hack Bold 9

# hide boarder if single window/container in output
hide_edge_borders smart

# Delay the reset of urgent hint workspace focus
force_display_urgency_hint 500 ms

focus_follows_mouse yes
default_orientation auto
workspace_auto_back_and_forth no
#mouse_warping none

# https://i3wm.org/docs/userguide.html#focus_on_window_activation
# The window will neither be focused, nor be marked urgent.
#focus_on_window_activation none
# The window will always be marked urgent, but the focus will not be stolen.
focus_on_window_activation urgent

no_focus [window_role="pop-up"]

# Default border style: normal[px]|pixel[px]|none
default_border pixel 2
default_floating_border normal 2

# Default border for programs
#for_window [class="^.*"] border pixel 2
#for_window [class="(?i)urxvt"] border pixel 2
#for_window [class="(?i)emacs"] border pixel 2
#for_window [class="(?i)firefox"] border none
#for_window [class="(?i)chromium"] border none
#for_window [class="(?i)pale moon"] border none
#for_window [class="(?i)icecat"] border none
#for_window [class="(?i)mplayer"] border none
#for_window [class="(?i)mpv"] border none

# Colors
# class                 border  backgr. text    split_indicator child_border
client.focused          #285577 #285577 #dddddd #2e9ef4   #285577
client.focused_inactive #282828 #282828 #888888 #303030   #282828
client.unfocused        #101010 #101010 #555555 #181818   #101010
client.urgent           #c02020 #c02020 #ffffff #c02020   #c02020
# placeholder (border, indicator, and child_border are ignored)
client.placeholder      #0000ff #202020 #888888 #0000ff   #0000ff
# for windows that do not render all the way (mpv sometimes)
client.background       #000000

#
# Workspaces and outputs
#

# Switch to workspace
bindsym $ModK+1 workspace 1
bindsym $ModK+2 workspace 2
bindsym $ModK+3 workspace 3
bindsym $ModK+4 workspace 4
bindsym $ModK+5 workspace 5
bindsym $ModK+6 workspace 6
bindsym $ModK+7 workspace 7
bindsym $ModK+8 workspace 8
bindsym $ModK+9 workspace 9
bindsym $ModK+0 workspace 10

# Move focused container to workspace
bindsym $ModK+Shift+1 move workspace 1
bindsym $ModK+Shift+2 move workspace 2
bindsym $ModK+Shift+3 move workspace 3
bindsym $ModK+Shift+4 move workspace 4
bindsym $ModK+Shift+5 move workspace 5
bindsym $ModK+Shift+6 move workspace 6
bindsym $ModK+Shift+7 move workspace 7
bindsym $ModK+Shift+8 move workspace 8
bindsym $ModK+Shift+9 move workspace 9
bindsym $ModK+Shift+0 move workspace 10

# Assign workspace to output
workspace 1 output $screenL
workspace 2 output $screenL
workspace 3 output $screenL
workspace 4 output $screenL
workspace 5 output $screenL
workspace 6 output $screenR
workspace 7 output $screenR
workspace 8 output $screenR
workspace 9 output $screenR
workspace 10 output $screenR

# Default workspace assignment for programs
#assign [window_role="^browser$"] → 10
#assign [class="^Pidgin$"] → 9
#for_window [class="(?i)^.*wine.*$"] floating enable
assign [class="(?i)^.*steam.*$"] → 1
#for_window [class="(?i)^UE4Editor.*$"] floating enable
#assign [class="(?i)^UE4Editor.*$"] → 8

#
# Bindings
#

# Use Mouse+ModK to drag floating windows to their wanted position
floating_modifier $ModK

set $locker ~/bin/lock
set $wallpaper ~/.i3/wallpaper_cycle

# Lock, Restart, Reboot...
set $mode_system "    <u>e</u>xit  relo<u>a</u>d  <u>r</u>estart    <u>s</u>uspend  <u>h</u>ibernate    <u>S</u>hutdown  <u>R</u>eboot    <u>w</u>allpaper    setup-<u>x</u>randr    "
mode --pango_markup $mode_system {
    bindsym l exec --no-startup-id $locker, mode "default"
    bindsym c exec --no-startup-id $locker, mode "default"
    # Exit i3 (logs you out of your X session)
    bindsym e exec --no-startup-id i3-msg exit, mode "default"
    # Reload i3 configuration file
    bindsym a exec --no-startup-id i3-msg reload, mode "default"
    # Restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
    bindsym r exec --no-startup-id i3-msg restart, mode "default"
    bindsym s exec --no-startup-id $locker && systemctl suspend, mode "default"
    bindsym h exec --no-startup-id $locker && systemctl hibernate, mode "default"
    bindsym Shift+s exec --no-startup-id systemctl poweroff -i, mode "default"
    bindsym Shift+r exec --no-startup-id systemctl reboot, mode "default"
    # Wallpaper
    bindsym b exec --no-startup-id $wallpaper, mode "default"
    bindsym w exec --no-startup-id $wallpaper, mode "default"
    #
    bindsym x exec --no-startup-id ~/bin/setup-xrandr, mode "default"
    # back to normal: Enter or Escape
    bindsym q mode "default"
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $ModK+Escape mode $mode_system

# Toggle border decoration
bindsym $ModK+e border toggle

# Kill focused window
bindsym $ModK+q kill

# Move to scrathpad
bindsym $ModK+Shift+grave move scratchpad
# Toggle scratchpad
bindsym $ModK+grave scratchpad show

# Change focus
bindsym $ModK+$keyLeft          focus left
bindsym $ModK+$keyDown          focus down
bindsym $ModK+$keyUp            focus up
bindsym $ModK+$keyRight         focus right
bindsym $ModK+Left              focus left
bindsym $ModK+Down              focus down
bindsym $ModK+Up                focus up
bindsym $ModK+Right             focus right

# Move focused window
bindsym $ModK+Shift+$keyLeft    move left
bindsym $ModK+Shift+$keyDown    move down
bindsym $ModK+Shift+$keyUp      move up
bindsym $ModK+Shift+$keyRight   move right
bindsym $ModK+Shift+Left        move left
bindsym $ModK+Shift+Down        move down
bindsym $ModK+Shift+Up          move up
bindsym $ModK+Shift+Right       move right

# Focus other output (when multi screen)
bindsym $ModK+Tab focus output right

# Split in vertical orientation
bindsym $ModK+v split v

# Split in horizontal orientation
bindsym $ModK+b split h

# Focus the parent container
bindsym $ModK+x focus parent

# Focus the child container
bindsym $ModK+c focus child

# Change container layout
bindsym $ModK+a layout tabbed
bindsym $ModK+s layout stacking
bindsym $ModK+d layout toggle split

# Enter fullscreen mode for the focused container
bindsym $ModK+f fullscreen

# Toggle tiling / floating
bindsym $ModK+Shift+space floating toggle

# Change focus between tiling / floating windows
bindsym $ModK+space focus mode_toggle

# Resize window (you can also use the mouse for that)
set $mode_resize "    [resize]    "
mode $mode_resize {
    bindsym $keyLeft        resize shrink left  $resize_step px
    bindsym Shift+$keyLeft  resize grow   left  $resize_step px
    bindsym $keyDown        resize shrink down  $resize_step px
    bindsym Shift+$keyDown  resize grow   down  $resize_step px
    bindsym $keyUp          resize shrink up    $resize_step px
    bindsym Shift+$keyUp    resize grow   up    $resize_step px
    bindsym $keyRight       resize shrink right $resize_step px
    bindsym Shift+$keyRight resize grow   right $resize_step px
    bindsym Left            resize shrink left  $resize_step px
    bindsym Shift+Left      resize grow   left  $resize_step px
    bindsym Down            resize shrink down  $resize_step px
    bindsym Shift+Down      resize grow   down  $resize_step px
    bindsym Up              resize shrink up    $resize_step px
    bindsym Shift+Up        resize grow   up    $resize_step px
    bindsym Right           resize shrink right $resize_step px
    bindsym Shift+Right     resize grow   right $resize_step px
    bindsym q mode "default"
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $ModK+r mode $mode_resize

#
# Bindings to launch programs
#

# Start rofi program launcher
#bindsym $ModK+z exec dmenu_run -b -p ">>" -nb '#222222' -nf '#CCCCCC' -sb '#4c7899' -sf '#FFFFFF'
#bindsym $ModK+z exec rofi -show run
#bindsym $ModK+z exec --no-startup-id "rofi -show combi -combi-modi 'run,ssh,window' -modi combi"
bindsym $ModK+z exec --no-startup-id "rofi -show combi -display-combi ' launch' -modi combi -combi-modi 'drun,flatpak:~/.i3/rofi_flatpak.sh,run,window'"

# Cliboard Manager
bindsym $ModK+Insert exec --no-startup-id CM_LAUNCHER=rofi clipmenu -p ' clip' -i
exec_always --no-startup-id systemctl --user restart clipmenud.service

# Mpv Clipboard (mpvcb)
bindsym $ModK+y exec --no-startup-id ~/bin/mpvcb --rofi --clipmenu-args -p ' mpv' -i

# Overriding Shift-Insert to type what's in primary clipboard (selection)
# (xdotool bugge ? seems to type while Shift is pressed ?)
#bindsym Shift+Insert exec --no-startup-id "bash -c 'xdotool type \\"$(xclip -selection primary -o -r)\\"'
#bindsym Shift+Insert exec --no-startup-id "bash -c 'xclip -selection primary -o -r | xvkbd -xsendevent -delay 1 -file -'"

# Screenshot
bindsym $ModK+Print exec --no-startup-id ~/bin/scrot-rofi

# Volume: Pulse Audio
#set $volume_mute      exec --no-startup-id pactl set-sink-mute   '@DEFAULT_SINK@' toggle
# set $volume_inc       exec --no-startup-id pactl set-sink-volume '@DEFAULT_SINK@' +10%
# set $volume_dec       exec --no-startup-id pactl set-sink-volume '@DEFAULT_SINK@' -10%
# set $volume_inc_shift exec --no-startup-id pactl set-sink-volume '@DEFAULT_SINK@' +10%
# set $volume_dec_shift exec --no-startup-id pactl set-sink-volume '@DEFAULT_SINK@' -10%
set $volume_mute      exec --no-startup-id ~/bin/pamixer-notify --toggle-mute
set $volume_inc       exec --no-startup-id ~/bin/pamixer-notify --increase 10
set $volume_dec       exec --no-startup-id ~/bin/pamixer-notify --decrease 10
set $volume_inc_shift exec --no-startup-id ~/bin/pamixer-notify --increase 10
set $volume_dec_shift exec --no-startup-id ~/bin/pamixer-notify --decrease 10
# +/-
bindsym $ModK+equal $volume_inc
bindsym $ModK+minus $volume_dec
bindsym $ModK+Shift+equal $volume_inc_shift
bindsym $ModK+Shift+minus $volume_dec_shift
# Media keys volume up/down
bindsym XF86AudioRaiseVolume $volume_inc
bindsym XF86AudioLowerVolume $volume_dec
bindsym $ModK+XF86AudioRaiseVolume $volume_inc
bindsym $ModK+XF86AudioLowerVolume $volume_dec
bindsym Shift+XF86AudioRaiseVolume $volume_inc_shift
bindsym Shift+XF86AudioLowerVolume $volume_dec_shift
bindsym $ModK+Shift+XF86AudioRaiseVolume $volume_inc_shift
bindsym $ModK+Shift+XF86AudioLowerVolume $volume_dec_shift
# F11/F12
bindsym $ModK+F12 $volume_inc
bindsym $ModK+F11 $volume_dec
bindsym $ModK+Shift+F12 $volume_inc_shift
bindsym $ModK+Shift+F11 $volume_dec_shift
# Mute media keys
bindsym XF86AudioMute $volume_mute
bindsym Shift+XF86AudioMute $volume_mute
bindsym $ModK+XF86AudioMute $volume_mute
bindsym $ModK+Shift+XF86AudioMute $volume_mute

# Player: Playerctl
set $player_play  exec --no-startup-id playerctl play-pause
set $player_pause exec --no-startup-id playerctl pause
set $player_next  exec --no-startup-id playerctl next
set $player_prev  exec --no-startup-id playerctl previous
# Player: MPD
# set $player_play  exec --no-startup-id mpc -q toggle
# set $player_pause exec --no-startup-id mpc -q stop
# set $player_next  exec --no-startup-id mpc -q next
# set $player_prev  exec --no-startup-id mpc -q prev
# Page Up/Down, End
bindsym $ModK+End $player_play
bindsym $ModK+Prior $player_prev
bindsym $ModK+Next $player_next
# Media Keys
bindsym XF86AudioPlay $player_play
bindsym XF86AudioPrev $player_prev
bindsym XF86AudioNext $player_next
bindsym XF86AudioStop $player_pause
bindsym $ModK+XF86AudioPlay $player_play
bindsym $ModK+XF86AudioPrev $player_prev
bindsym $ModK+XF86AudioNext $player_next
bindsym $ModK+XF86AudioStop $player_pause
#bindsym $ModK+F8 $player_play
#bindsym $ModK+F9 $player_prev
#bindsym $ModK+F10 $player_next

# On/Off Touchpad
bindsym XF86TouchpadToggle exec --no-startup-id zsh ~/bin/toggletouchpad

# Lock
#bindsym $ModK+w exec --no-startup-id "/bin/bash --login -c 'sleep 0.5; xtrlock; exit 0'"
bindsym $ModK+w exec --no-startup-id $locker

# Terminal
#bindsym $ModK+Return exec --no-startup-id $layouts/launch.sh urxvt
bindsym $ModK+Return exec urxvt

# Emacs
bindsym $ModK+Shift+Return exec --no-startup-id $layouts/launch.sh -- emacs
bindsym $ModK+Ctrl+Return exec --no-startup-id $layouts/launch.sh -- emacs ~/TODO.org

# Firefox
set $browser firefox
bindsym $ModK+F10       exec --no-startup-id $layouts/launch.sh -w 10 $browser
bindsym $ModK+Shift+F10 exec --no-startup-id $layouts/launch.sh $browser
bindsym $ModK+F3        exec --no-startup-id $layouts/launch.sh -w 3 $browser
bindsym $ModK+Shift+F3  exec --no-startup-id $layouts/launch.sh $browser

# Qalculate
bindsym $ModK+F5 exec $layouts/launch.sh qalculate-gtk -n

# Redshift
bindsym $ModK+o       exec --no-startup-id ~/bin/red +1
bindsym $ModK+p       exec --no-startup-id ~/bin/red -1
bindsym $ModK+Shift+o exec --no-startup-id ~/bin/red -c +1
bindsym $ModK+Shift+p exec --no-startup-id ~/bin/red -c -1

# Go to urgent window, and go back
bindsym $ModK+BackSpace exec --no-startup-id ~/.i3/goto_urgent_and_back.sh
bindsym $ModK+u         exec --no-startup-id ~/.i3/goto_urgent_and_back.sh

# set $search_polybar_win --name "^polybar-mybar-big$"
# bindsym $ModK+g exec xdotool search $search_polybar_win windowmove --relative %@ 0 -21
# bindsym $ModK+g --release exec xdotool search $search_polybar_win windowmove --relative %@ 0 21

#
# Bar
#

# Bar
bar { # bar
    status_command i3status -c ~/.i3/i3status.conf
    separator_symbol "   "
    mode hide
    position bottom
    colors {
        background #101010
        statusline #E0E0E0
    }
}

#
# Run at startup
#

exec --no-startup-id $wallpaper #; $locker
#exec conky -c ~/.conky/balloon/conkyrc

set $hook_idle_time_min 10
exec --no-startup-id xautolock -detectsleep -time $hook_idle_time_min -locker "~/bin/hooks/onidle" -noclose

#
# Spawn layouts and programs
# http://i3wm.org/docs/layout-saving.html
#
exec --no-startup-id $layouts/startup.sh
